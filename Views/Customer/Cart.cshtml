@model PUP_Online_Lagoon_System.Models.DTO.CustomerStallCheckoutDTO;
@{
    double subTotal = 0.0;
    int cartItemsCount = 0;
}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Cart</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="~/css/customer/cart.css" asp-append-version="true">
</head>
<body>

    <header class="cart-header">
        <a asp-controller="Customer" asp-action="StallMenu" asp-route-stallId="@Model.stallDetails.Stall_ID" class="back-button">
            <i class="fas fa-arrow-left"></i>
        </a>
        <h1 class="header-title">My Cart</h1>
    </header>

    <div class="cart-container">
        @if (@PUP_Online_Lagoon_System.Models.DTO.CustomerStallCheckoutDTO.staticCart.TryGetValue(Model.customerId, out List<@PUP_Online_Lagoon_System.Models.DTO.CartItem> cart))
        {
            cartItemsCount = cart.Count();

            foreach (var cartItem in cart)
            {
                subTotal += cartItem.Price;

                <div class="cart-item">
                    <div class="item-img-box"></div> <div class="item-details">
                        <h3 class="item-name">@cartItem.FoodName</h3>
                        <p class="item-desc">@cartItem.FoodDescription</p>
                        <p class="item-price">₱@cartItem.originalPrice</p>

                        <div class="counter-box">
                            <button class="btn-minus" onclick="reduceQuantity('@cartItem.Food_ID')">−</button>
                            <span class="count-num" id="@cartItem.Food_ID">@cartItem.Quantity</span>
                            <button class="btn-plus" onclick="increaseQuantity('@cartItem.Food_ID', @cartItem.totalQuantityRemain)">+</button> 
                        </div>
                    </div>

                    <div class="item-actions">
                        <span class="item-total-price">₱@cartItem.Price</span>
                        <form asp-controller="Customer" asp-action="RemoveFromCart" method="post">
                            <input type="hidden" name="foodId" value="@cartItem.Food_ID" />
                            <input type="hidden" name="stallId" value="@cartItem.Stall_ID" />
                            <input type="hidden" name="customerId" value="@Model.customerId" />
                            <button class="btn-delete">
                                <i class="fas fa-trash-can"></i>
                            </button>
                        </form>
                    </div>
                </div>
            }
        } 
        else
        {
            <h1>No item here yet...</h1>
        }
    
    @if(cartItemsCount > 0) {
        <div class="cart-footer">
            <div class="summary-row">
                <span>Subtotal</span>
                <span>₱ @subTotal</span>
            </div>
            <div class="summary-row">
                <span>Service Fee</span>
                <span>₱5.00</span>
            </div>
            <div class="summary-row total-row">
                <span>Total</span>
                <span class="total-amount">₱ @(subTotal + 5)</span>
            </div>

            <a asp-controller="Customer" asp-action="Checkout" asp-route-stallId="@Model.stallDetails.Stall_ID" class="btn-checkout" style="text-decoration: none; display: block; text-align: center;">
                Proceed to Checkout
            </a>
        </div>
    } 

</body>

<script>
    function reduceQuantity(food_Id)
    {
        const quantityElement = document.getElementById(`${food_Id}`);
        quantityElement.textContent -= 1;
    }

    function increaseQuantity(food_Id, quantity)
    {
        const quantityElement = document.getElementById(`${food_Id}`);

        if(quantityElement.textContent < quantity) {
            quantityElement.textContent = parseInt(quantityElement.textContent) + 1;
        }

        quantityUpdateTag(food_Id, quantityElement.value);
    }
</script>
